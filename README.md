# MongoDB Fraud Detection Backend API

This is a backend API designed to identify and analyze fraudulent behavior in financial transactions by processing event data stored in a MongoDB database. The application allows for event insertion, querying, and generating reports to analyze transaction statuses for a specific user over defined time periods. It is based on the article by Artur Costa [The Cost of Not Knowing MongoDB](https://www.mongodb.com/developer/products/mongodb/cost-of-not-knowing-mongodb/)

## Features

- **Event Generation**: Insert transaction events for users, with statuses such as `approved`, `declined`, `pending`, and `rejected`.
- **Reports Generation**: Generate reports for a user, summarizing transaction statuses over time periods like 1 year, 3 years, 5 years, 7 years, and 10 years.
- **Bulk Event Insertion**: Support for bulk event generation and insertion to simulate large-scale transaction data.
- **API Endpoints**: Expose various endpoints to insert events, generate reports, and trigger event generation via HTTP requests.

## Tech Stack

- **Node.js**: Backend runtime for the application.
- **Hono**: Lightweight and fast web framework for building the REST API.
- **MongoDB**: NoSQL database used for storing event data and generating reports.
- **Bun.js**: Fast JavaScript runtime for building the backend (alternative to Node.js if using Bun.js).
- **TypeScript**: Primary language for writing backend logic, event generation, and API routes.
- **Docker**: Used to run MongoDB via Docker container.

## Application Workflow

1. **Event Generation**: The application allows for generating transaction events that are associated with a user (identified by a unique key) and a transaction status (e.g., `approved`, `pending`). The events are inserted into the MongoDB database using an upsert operation, ensuring that the data is updated if the user already exists.

2. **Report Generation**: The application allows generating transaction reports for a user, summarizing the total number of each transaction status over time periods ranging from 1 year to 10 years. These reports are generated by querying the database for transactions that fall within the specified date range and grouping the results by status.

3. **API Endpoints**:
   - **POST /api/events**: Insert a single event for a user.
   - **POST /api/events/bulk?numOfUsers=5&numOfEventsPerUser=10&startYear=2014&endYear=2024**: Insert multiple events in bulk.
   - **GET /api/reports/:userKey/:endDate**: Generate a report for a user within the last 1, 3, 5, 7, or 10 years based on the provided end date.

## How to Use

### Running the Backend Server

1. Clone the repository:

   ```bash
   git clone <repository_url>
   cd <project_directory>
   ```

2. Install dependencies:

   ```bash
   bun install
   ```

3. Start the server:

   ```bash
   bun run dev
   ```

   The API will be available at `http://localhost:3001`.

4. Install and run MongoDB via Docker:

If you don't have MongoDB installed on your machine, you can use Docker to run MongoDB. To do this, you need to have Docker installed. Then run the following command:

```bash
bun run docker
```

This command will automatically pull the latest MongoDB Community Docker image and run it. The MongoDB service will be available at `mongodb://localhost:27017`.

The API will be available at `http://localhost:3001`.

Don't forget to add your MongoDB connection string to your `.env` file as per the `.env.example`

5. Generate bulk events:

   ```bash
   bun run bulk:events
   ```

### API Endpoints

- **POST /api/events**: Insert a single event for a user.

  Example request body:

  ```json
  {
    "key": "c2766cf6fb4db31afa5674729597bd670b125786b5f2f825bca451ebb9adc4ed",
    "date": "2022-02-01T00:00:00.000Z",
    "pending": 1
  }
  ```

- **POST /api/events/bulk**: Insert multiple events in bulk.

  Example response body:

  ```json
  [
    {
      "key": "c2766cf6fb4db31afa5674729597bd670b125786b5f2f825bca451ebb9adc4ed",
      "date": "2022-02-01T00:00:00.000Z",
      "status": "pending"
    },
    {
      "key": "c2766cf6fb4db31afa5674729597bd670b125786b5f2f825bca451ebb9adc4ed",
      "date": "2022-02-01T00:00:00.000Z",
      "status": "approved"
    }
  ]
  ```

- **GET /api/reports/:userKey/:endDate**: Generate a report for a user for the last 1, 3, 5, 7, or 10 years based on the provided end date.

  Example URL: `http://localhost:3000/api/reports/c2766cf6fb4db31afa5674729597bd670b125786b5f2f825bca451ebb9adc4ed/2022-06-15T00:00:00.000Z`

  Example response:

  ```json
  [
    {
      "id": "oneYear",
      "start": "2021-06-15T00:00:00.000Z",
      "end": "2022-06-15T00:00:00.000Z",
      "totals": {
        "approved": 4,
        "declined": 1,
        "pending": 1,
        "rejected": 1
      }
    },
    {
      "id": "threeYears",
      "start": "2019-06-15T00:00:00.000Z",
      "end": "2022-06-15T00:00:00.000Z",
      "totals": {
        "approved": 8,
        "declined": 2,
        "pending": 2,
        "rejected": 2
      }
    }
  ]
  ```

### Testing with Postman

- Use **Postman** to send `POST` requests to `/api/events` or `/api/events/bulk` to generate events.
- Use **Postman** to send a `GET` request to `/api/reports/:userKey/:endDate` to generate reports for a specific user.
